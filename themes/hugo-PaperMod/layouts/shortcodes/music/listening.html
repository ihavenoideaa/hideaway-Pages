<div id="songlist">loading...（加载中...加载失败请刷新）</div>
<!-- require APlayer -->
<script type="text/javascript" src="/APlayer.min.js"></script>

<script type="text/javascript" src="/moment.min.js"></script>
<script type="text/javascript" src="/moment.twitter.js"></script>
<!-- require MetingJS -->

<script>
document.addEventListener("DOMContentLoaded", () => {
    let limit = 2
    var memoUrl = "https://memos.xzgljiang.com/"            // memos url
    //var creatorId = 101
    //var galleryUrl = memoUrl+"api/memo?creatorId="+creatorId+"&rowStatus=NORMAL&limit="+limit+"&tag=相册"
    var galleryUrl = memoUrl+"api/memo/all?rowStatus=NORMAL&limit="+limit+"&tag=最近在听"
    let nowNum = 1;
    fetch(galleryUrl).then(res => res.json()).then( resdata =>{
        var result = '',resultAfter='',resultAll="",data = resdata.data
        for(var i=0;i < data.length;i++){
            var songMemos = data[i].content.replace("#最近在听 ",'')   			// songMemos 标签后的全部信息 
            var songinfo = songMemos.match(/\[(.*?)\s*(.*?)\]\((.*?)\)/g)		// songinfo []() 符合这个格式的信息
            var comment = songMemos.split(songinfo)[1]                          // []()后的评论
            //解析 content 内 md 格式图片
            if(songinfo){
              songinfo.forEach(item => {
                if(nowNum < limit ){
                  nowNum ++
                  let songurl = item.replace(/\[.*?\]\((.*?)\)/g,'$1'),			// 括号内的url
                      singer, songname, tmp = item.replace(/\[(.*?)\]\(.*?\)/g,'$1');	// [time title]
                  if (tmp.indexOf(' ') != -1) {
                      singer = tmp.split(' ')[0];
                      songname = tmp.split(' ')[1];
                  } else songname = tmp
				  
                  var tencenttype = songurl.match(/y\.qq\.com\/n\/ryqq\/songDetail/g)
					        var neteasetype = songurl.match(/music\.163\.com/g)
                  var spotify = songurl.match(/open\.spotify\.com/g)
					        var songtype = ''	
                  var songmid = ''
                  if(tencenttype || neteasetype){
				            // 链接是qq音乐的
					          if(tencenttype) {
						          songtype = 'tencent'
					            // QQ 音乐直链https://y.qq.com/n/ryqq/songDetail/002e4D4n44U4zE  网易云https://music.163.com/#/song?id=64803 netease
					            songmid = songurl.split('/songDetail/')[1]
                      resultAfter = `<div style="font-size:small; text-align: right;display: block; margin-right:4px" ><a href="${songurl}" target="_blank"><svg style="margin:0 0 -2 0;" width="1.3em" height="1.3em" viewBox="-147 -173.29999999999998 470 492.29999999999995" xmlns="http://www.w3.org/2000/svg" width="2317" height="2500"><linearGradient id="a" gradientTransform="rotate(-90 1397 232)" gradientUnits="userSpaceOnUse" x1="1310" x2="1780" y1="-1077" y2="-1077"><stop offset="0" stop-color="#fbbe0a"/><stop offset="1" stop-color="#feda24"/></linearGradient><circle cx="88" cy="84" fill="url(#a)" r="235"/><path d="M123.8 104c-5.9-8.3-11.5-16.1-17.1-23.8C85.2 50.4 63.6 20.6 42-9.1 28.3-28 14.7-46.9.8-65.6-3.4-71.2-3.9-77.1-2-83.5c3.9-13.3 13.2-22.5 24.2-30.1 20.1-13.9 42.8-21 66.6-25.2 20.7-3.6 41.2-8 59.3-19.4 4.9-3.1 9-7.3 13.5-11 1.2-1 2.3-2.1 4.6-4.1 1.5 7.3 3 13.4 4 19.5 3 18 1.9 35.5-6.2 52.1-11 22.4-29 36.4-52.6 43.6C97-53.5 82.1-52.4 67-52.5c-1.1 0-2.2.3-4.1.5 3.7 6.5 7 12.6 10.6 18.5 14.5 23.7 29 47.4 43.4 71.2l47.4 78.6c4.1 6.8 8.4 13.6 12.4 20.5 9.3 16 16.1 32.7 14.8 51.9-1.3 18.8-8.1 35.2-19.8 49.6-19.1 23.5-43.9 37.1-73.5 42.4-27.9 4.9-54.5 1.8-79.2-12.3-27.8-15.8-45.6-44.5-41.4-78.7 2.7-22.5 13.9-41.1 30.4-56.4 17.6-16.2 38.5-26.1 61.8-30.6 17.2-3.4 34.4-3.2 51.4 1.4.5.1 1.1-.1 2.6-.1z" fill="#0daf52"/></svg></a>&nbsp [ `  + moment(data[i].createdTs * 1000).twitter() + ` ]</div>&nbsp;`
                    }
					          // 链接是网易云的
					          if(neteasetype) {
						          songtype = 'netease'
						          songmid = songurl.split('id=')[1]
                      resultAfter = `<div style="font-size:small; text-align: right;display: block; margin-right:4px" ><a title="Spotify 音乐需要🧙🏼" href="${songurl}" target="_blank"><svg style="margin:0 0 -2 0;" width="1.3em" height="1.3em" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19969" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M814.08 455.68C650.24 358.4 376.32 348.16 220.16 396.8c-25.6 7.68-51.2-7.68-58.88-30.72-7.68-25.6 7.68-51.2 30.72-58.88 181.76-53.76 481.28-43.52 670.72 69.12 23.04 12.8 30.72 43.52 17.92 66.56-12.8 17.92-43.52 25.6-66.56 12.8m-5.12 143.36c-12.8 17.92-35.84 25.6-53.76 12.8-138.24-84.48-348.16-110.08-509.44-58.88-20.48 5.12-43.52-5.12-48.64-25.6-5.12-20.48 5.12-43.52 25.6-48.64 186.88-56.32 417.28-28.16 576 69.12 15.36 7.68 23.04 33.28 10.24 51.2m-61.44 140.8c-10.24 15.36-28.16 20.48-43.52 10.24-120.32-74.24-271.36-89.6-450.56-48.64-17.92 5.12-33.28-7.68-38.4-23.04-5.12-17.92 7.68-33.28 23.04-38.4 194.56-43.52 363.52-25.6 496.64 56.32 17.92 7.68 20.48 28.16 12.8 43.52M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S796.16 0 512 0" fill="#1DB954" p-id="19970"></path></svg></a>&nbsp [ `  + moment(data[i].createdTs * 1000).twitter() + ` ]</div>&nbsp;`
					          }
				            result += `<meting-js id="${songmid}" server="${songtype}" type="song" fixed="false" mini="false" autoplay="false" loop="none" theme="#255579" volume="0.6" prelosd="auto" mutex="true" list-folded="true"></meting-js>`
                    result += `<span style="font-size:17px;font-weight: lighter; margin:5px 0 0 5px;">`
                    if(Object.keys(comment).length === 0){
                    } else{
                      result += `“${comment}” </span>`
                    }                  
                  }
                    // 链接是spotify的链接
                  if(spotify){
                    songtype = songurl.split('spotify.com/')[1].split('/')[0]
                    songmid = songurl.split('spotify.com/')[1].split('/')[1]
                    resultAfter = `<div style="font-size:small; text-align: right;display: block; margin-right:4px" ><a title="Spotify 音乐需要🧙🏼" href="${songurl}" target="_blank"><svg style="margin:0 0 -3 0;" width="3.3em" height="3.3em" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19969" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M814.08 455.68C650.24 358.4 376.32 348.16 220.16 396.8c-25.6 7.68-51.2-7.68-58.88-30.72-7.68-25.6 7.68-51.2 30.72-58.88 181.76-53.76 481.28-43.52 670.72 69.12 23.04 12.8 30.72 43.52 17.92 66.56-12.8 17.92-43.52 25.6-66.56 12.8m-5.12 143.36c-12.8 17.92-35.84 25.6-53.76 12.8-138.24-84.48-348.16-110.08-509.44-58.88-20.48 5.12-43.52-5.12-48.64-25.6-5.12-20.48 5.12-43.52 25.6-48.64 186.88-56.32 417.28-28.16 576 69.12 15.36 7.68 23.04 33.28 10.24 51.2m-61.44 140.8c-10.24 15.36-28.16 20.48-43.52 10.24-120.32-74.24-271.36-89.6-450.56-48.64-17.92 5.12-33.28-7.68-38.4-23.04-5.12-17.92 7.68-33.28 23.04-38.4 194.56-43.52 363.52-25.6 496.64 56.32 17.92 7.68 20.48 28.16 12.8 43.52M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S796.16 0 512 0" fill="#1DB954" p-id="19970"></path></svg></a>&nbsp [ `  + moment(data[i].createdTs * 1000).twitter() + ` ]</div>&nbsp;`
                    if(songtype == "track")
                    {
                      result += `<iframe id="myIframe" src="https://open.spotify.com/embed/${songtype}/${songmid}/" width="100%" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>`
                    }else{
                      result += `<iframe id="myIframe" src="https://open.spotify.com/embed/${songtype}/${songmid}/" width="100%" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>`
                    }
                    result += `<div style="font-size:17px;font-weight: lighter; margin:5px 0 0 5px;">`
                    if(Object.keys(comment).length === 0){
                    } else{
                      result += `“${comment}” </div>`
                    }
                  }
                }
              });
            }
        }
        var songDom = document.querySelector('#songlist');
        resultAfter = result + resultAfter
        songDom.innerHTML = resultAfter
    });
});
</script>